<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Codex: Saberes Vernáculos y Patrimonio</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Barlow:ital,wght@0,300;0,400;0,600;0,700;1,400&family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            /* TEMA: BLUEPRINT CAD (Azul oscuro, Cian, Blanco técnico) */
            --cad-bg: #0d1117;
            --cad-panel: #161b22;
            --cad-line: #30363d;
            --cad-text: #c9d1d9;
            
            --accent: #2f81f7; /* Azul selección */
            --cyan: #3fb950;   /* Verde técnico (Correcto) */
            --alert: #f85149;  /* Rojo error */
            --warn: #d29922;   /* Amarillo aviso */
            
            --font-main: 'Barlow', sans-serif;
            --font-code: 'IBM Plex Mono', monospace;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; user-select: none; }

        body {
            background-color: var(--cad-bg);
            color: var(--cad-text);
            font-family: var(--font-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            /* Grid de fondo tipo CAD */
            background-image: 
                linear-gradient(rgba(48, 54, 61, 0.3) 1px, transparent 1px),
                linear-gradient(90deg, rgba(48, 54, 61, 0.3) 1px, transparent 1px);
            background-size: 40px 40px;
        }

        /* --- HEADER --- */
        header {
            height: 60px;
            background: var(--cad-panel);
            border-bottom: 1px solid var(--cad-line);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 100;
        }

        .sys-title {
            font-family: var(--font-code);
            font-weight: 700;
            color: var(--accent);
            letter-spacing: -0.5px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .sys-ver { font-size: 0.7rem; color: var(--cad-line); border: 1px solid var(--cad-line); padding: 2px 6px; border-radius: 4px; }

        .stats-deck { display: flex; gap: 30px; font-family: var(--font-code); font-size: 0.8rem; }
        .stat span { color: #8b949e; margin-right: 5px; }
        .stat strong { color: #f0f6fc; }

        /* --- MAIN LAYOUT --- */
        .workspace {
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            height: calc(100vh - 60px);
        }

        /* --- LEFT: LAYERS (NAV) --- */
        .layers-panel {
            background: var(--cad-panel);
            border-right: 1px solid var(--cad-line);
            display: flex;
            flex-direction: column;
        }

        .panel-head {
            padding: 15px 20px;
            font-family: var(--font-code);
            font-size: 0.75rem;
            color: #8b949e;
            text-transform: uppercase;
            border-bottom: 1px solid var(--cad-line);
        }

        .layer-list { overflow-y: auto; flex: 1; }

        .layer-btn {
            padding: 15px 20px;
            border-left: 2px solid transparent;
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid rgba(48, 54, 61, 0.5);
        }

        .layer-btn:hover { background: rgba(255,255,255,0.03); }
        
        .layer-btn.active {
            background: rgba(47, 129, 247, 0.1);
            border-left-color: var(--accent);
        }
        .layer-btn.active .l-title { color: var(--accent); }

        .l-title { font-weight: 600; font-size: 0.95rem; display: block; margin-bottom: 4px; }
        .l-sub { font-size: 0.8rem; color: #8b949e; }

        /* --- CENTER: VIEWPORT --- */
        .viewport {
            position: relative;
            padding: 40px;
            overflow-y: auto;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        /* Crosshair cursor for CAD feel */
        .viewport { cursor: crosshair; }

        .cad-card {
            background: #0d1117;
            border: 1px solid var(--cad-line);
            width: 100%;
            max-width: 900px;
            padding: 40px;
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        /* Corner markers */
        .marker { position: absolute; width: 10px; height: 10px; border: 1px solid var(--cad-line); }
        .m-tl { top: -1px; left: -1px; border-right: none; border-bottom: none; }
        .m-tr { top: -1px; right: -1px; border-left: none; border-bottom: none; }
        .m-bl { bottom: -1px; left: -1px; border-right: none; border-top: none; }
        .m-br { bottom: -1px; right: -1px; border-left: none; border-top: none; }

        .q-meta {
            font-family: var(--font-code);
            font-size: 0.8rem;
            color: var(--accent);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
        }

        .q-text {
            font-size: 1.4rem;
            line-height: 1.5;
            color: #f0f6fc;
            margin-bottom: 30px;
            font-weight: 400;
        }

        .opts-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .opt {
            background: rgba(22, 27, 34, 0.8);
            border: 1px solid var(--cad-line);
            padding: 18px 20px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            font-size: 0.95rem;
            color: #c9d1d9;
        }

        .opt:hover:not(.disabled) { border-color: var(--accent); background: rgba(47, 129, 247, 0.05); }
        
        .opt.selected { border-color: var(--accent); background: rgba(47, 129, 247, 0.15); color: #fff; }
        .opt.correct { border-color: var(--cyan); background: rgba(63, 185, 80, 0.1); color: var(--cyan); }
        .opt.wrong { border-color: var(--alert); background: rgba(248, 81, 73, 0.1); opacity: 0.6; }

        .opt-key {
            font-family: var(--font-code);
            margin-right: 15px;
            color: #8b949e;
            font-size: 0.8rem;
        }

        /* --- FEEDBACK CONSOLE --- */
        .cmd-line {
            margin-top: 30px;
            background: #000;
            padding: 15px;
            font-family: var(--font-code);
            font-size: 0.85rem;
            border-left: 2px solid;
            display: none;
        }
        .cmd-line.ok { border-color: var(--cyan); color: var(--cyan); }
        .cmd-line.err { border-color: var(--alert); color: var(--alert); }
        .cmd-detail { color: #8b949e; margin-top: 5px; line-height: 1.4; display: block; }

        /* --- CONTROLS --- */
        .toolbar {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--cad-line);
            display: flex;
            justify-content: space-between;
        }

        .btn {
            background: transparent;
            border: 1px solid var(--cad-line);
            color: #8b949e;
            padding: 10px 24px;
            font-family: var(--font-code);
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn:hover:not(:disabled) { border-color: #c9d1d9; color: #c9d1d9; }
        
        .btn-primary { border-color: var(--accent); color: var(--accent); }
        .btn-primary:hover:not(:disabled) { background: var(--accent); color: #fff; }
        
        .btn:disabled { opacity: 0.3; cursor: not-allowed; }

        /* --- RIGHT: PROPERTIES (INFO) --- */
        .props-panel {
            background: var(--cad-panel);
            border-left: 1px solid var(--cad-line);
            padding: 0;
            display: flex;
            flex-direction: column;
        }

        .prop-list { overflow-y: auto; padding: 20px; }

        .prop-item {
            margin-bottom: 20px;
            font-size: 0.85rem;
            color: #8b949e;
            border-left: 2px solid var(--cad-line);
            padding-left: 15px;
        }
        .prop-key { color: var(--accent); display: block; margin-bottom: 4px; font-family: var(--font-code); font-size: 0.75rem; }

        /* WELCOME SCREEN */
        .splash {
            text-align: center;
            padding: 60px 20px;
        }
        .splash h1 { font-size: 2.5rem; margin-bottom: 20px; color: #fff; }
        .splash p { color: #8b949e; max-width: 500px; margin: 0 auto 40px auto; line-height: 1.6; }

        @media (max-width: 1200px) {
            .workspace { grid-template-columns: 220px 1fr; }
            .props-panel { display: none; }
        }
    </style>
</head>
<body>

<header>
    <div class="sys-title">
        ARCH_CODEX <span class="sys-ver">v8.0</span>
    </div>
    <div class="stats-deck">
        <div class="stat"><span>OBJ:</span><strong id="ui-module">INDEX</strong></div>
        <div class="stat"><span>ACC:</span><strong id="ui-acc">0%</strong></div>
        <div class="stat"><span>TIME:</span><strong id="ui-time">00:00</strong></div>
    </div>
</header>

<div class="workspace">
    <nav class="layers-panel">
        <div class="panel-head">PROJECT LAYERS</div>
        <div id="layer-list" class="layer-list"></div>
    </nav>

    <main class="viewport">
        <div class="cad-card" id="main-area">
            <div class="marker m-tl"></div><div class="marker m-tr"></div>
            <div class="marker m-bl"></div><div class="marker m-br"></div>
            
            <div class="splash">
                <h1>SISTEMA DE ESPECIALIZACIÓN</h1>
                <p>Base de datos cargada: <strong>Libro INPC (Saberes Ancestrales)</strong> y <strong>Guía de Arquitectura de Cuenca</strong>.<br><br>Este módulo contiene los detalles técnicos más profundos y específicos para el examen final.</p>
                <button class="btn btn-primary" id="start-btn">INICIAR CARGA DE DATOS</button>
            </div>
        </div>
    </main>

    <aside class="props-panel">
        <div class="panel-head">DATA LOG</div>
        <div id="prop-log" class="prop-list">
            <div style="text-align:center; padding-top:40px; color:#30363d; font-family:var(--font-code);">NO DATA SELECTED</div>
        </div>
    </aside>
</div>

<script>
/**
 * ARCH_CODEX KERNEL
 * Full Content: INPC Book & Cuenca Guide
 */

const DB = [
    {
        id: "MOD_01",
        title: "Tecnología Vernácula",
        desc: "Materiales, Herramientas y Estructura",
        qs: [
            {
                q: "En el entramado del bahareque, ¿cuál es la diferencia técnica entre usar 'Carrizo' y 'Sigse'?",
                opts: [
                    "Son la misma planta.",
                    "El Sigse es más fino y se usa para cielorrasos o divisiones ligeras; el Carrizo es más resistente y se usa en muros.",
                    "El Sigse es para el piso.",
                    "El Carrizo se pudre más rápido."
                ],
                correct: 1,
                why: "Detalle del libro INPC: El sigse (Cortaderia nitida) es una caña delgada para acabados finos; el carrizo (Arundo donax) es estructural para el 'empañetado'."
            },
            {
                q: "¿Qué función cumple la 'Solera' de madera en un muro de tapial?",
                opts: [
                    "Decorativa.",
                    "Elemento de amarre superior que distribuye la carga de la cubierta uniformemente sobre el muro de tierra.",
                    "Ventilación.",
                    "Dintel de ventana."
                ],
                correct: 1,
                why: "Fundamental: Sin la solera, las vigas del techo perforarían o agrietarían el muro de tierra por carga puntual."
            },
            {
                q: "Para la impermeabilización de la 'tortanda' (techo de barro bajo la teja), tradicionalmente se usaba:",
                opts: [
                    "Plástico negro.",
                    "Estiércol de caballo/vaca fermentado mezclado con arcilla.",
                    "Cemento.",
                    "Alquitrán."
                ],
                correct: 1,
                why: "Sabiduría ancestral: Las fibras y enzimas del estiércol fermentado crean una capa hidrófuga natural."
            },
            {
                q: "¿Qué es el 'Chaguarquero' y para qué sirve en la cubierta?",
                opts: [
                    "Un tipo de teja.",
                    "La vara floral del penco (agave), usada como viga ligera o para sacar fibras de amarre (cabuya).",
                    "Una herramienta.",
                    "Un clavo."
                ],
                correct: 1,
                why: "Material multifuncional andino. Su fibra (cabuya) reemplazaba a los clavos en los amarres de pares y nudillos."
            },
            {
                q: "La 'Cimentación Ciclópea' en la arquitectura popular se compone de:",
                opts: [
                    "Hormigón armado.",
                    "Piedra de río (canto rodado) y barro/cal, siendo más ancha que el muro.",
                    "Madera.",
                    "Ladrillo."
                ],
                correct: 1,
                why: "Es el 'zapato' del muro. Debe ser de piedra para evitar que la humedad del suelo suba por capilaridad al adobe."
            },
            {
                q: "¿Qué herramienta específica se usa para compactar la tierra dentro del encofrado del tapial?",
                opts: [
                    "Pala.",
                    "El 'Pisón' (mazo de madera pesado).",
                    "Cuchara de albañil.",
                    "Rodillo."
                ],
                correct: 1,
                why: "El pisón es la herramienta clave. La calidad del tapial depende de la fuerza del apisonado manual."
            },
            {
                q: "El 'Adobe' requiere un proceso de secado de aproximadamente:",
                opts: [
                    "1 día al horno.",
                    "3 a 4 semanas al sol, volteándolos periódicamente.",
                    "1 año.",
                    "No se seca."
                ],
                correct: 1,
                why: "Es un ladrillo 'crudo'. Si no se seca bien al sol, se agrieta o se deshace al construir."
            },
            {
                q: "¿Qué es el 'Enchagllado'?",
                opts: [
                    "Poner el techo.",
                    "El proceso de colocar y amarrar las cañas/carrizos en la estructura de madera del bahareque.",
                    "Pintar la casa.",
                    "Hacer el piso."
                ],
                correct: 1,
                why: "Es la fase de tejido del muro antes de lanzar el barro."
            },
            {
                q: "La madera de 'Chachacomo' era valorada en la colonia por:",
                opts: [
                    "Ser muy blanda.",
                    "Su extrema dureza y resistencia a la pudrición (usada en pilares y dinteles).",
                    "Su color azul.",
                    "Arder rápido."
                ],
                correct: 1,
                why: "Madera nativa de altura, casi extinta hoy, presente en las casas más antiguas de Cuenca."
            },
            {
                q: "¿Cuál es la función del 'Sobrecimiento'?",
                opts: [
                    "Sostener el techo.",
                    "Elevar el muro de tierra por encima del nivel del suelo para protegerlo de salpicaduras de lluvia.",
                    "Estética.",
                    "Ninguna."
                ],
                correct: 1,
                why: "Regla de oro: 'Botas de piedra y sombrero de teja'. El muro de tierra no debe tocar el suelo mojado."
            }
        ]
    },
    {
        id: "MOD_02",
        title: "Ritual y Sociedad",
        desc: "Cosmovisión Andina en la Construcción",
        qs: [
            {
                q: "¿Qué significa la 'Huasipichana'?",
                opts: [
                    "Herramienta de limpieza.",
                    "Fiesta ritual de inauguración de la casa ('barrido de la casa') donde se bendice el hogar.",
                    "El pago en dinero.",
                    "La demolición."
                ],
                correct: 1,
                why: "Es el rito de paso final. La casa cobra vida y se integra a la comunidad."
            },
            {
                q: "La 'Minga' o Convite constructivo se basa en el principio de:",
                opts: [
                    "Lucro.",
                    "Reciprocidad (Randimpa): 'Hoy por ti, mañana por mí'. Se da comida a cambio de trabajo.",
                    "Esclavitud.",
                    "Contrato legal."
                ],
                correct: 1,
                why: "La construcción vernácula no es un acto comercial, es un acto de cohesión social."
            },
            {
                q: "¿Por qué se entierra un 'pagamento' (huesos, chicha, comida) en los cimientos?",
                opts: [
                    "Para esconder basura.",
                    "Para pedir permiso a la Pachamama y asegurar que la casa no 'coma' a sus habitantes (protección).",
                    "Para fertilizar.",
                    "Por error."
                ],
                correct: 1,
                why: "Visión animista: la tierra está viva. Al excavar se la hiere y hay que compensarla."
            },
            {
                q: "La colocación de la Cruz o Bandera en la cumbrera del tejado simboliza:",
                opts: [
                    "Venta de la casa.",
                    "La 'Coronación' de la obra, protección divina y triunfo sobre el esfuerzo físico.",
                    "Nada.",
                    "Marca de agrimensura."
                ],
                correct: 1,
                why: "Es el momento más peligroso (trabajo en altura) y sagrado. Se celebra con cohetes y trago."
            },
            {
                q: "La madera para construcción debe cortarse preferiblemente en:",
                opts: [
                    "Luna Llena.",
                    "Luna Menguante (Cuarto Menguante).",
                    "Cualquier día.",
                    "Mediodía."
                ],
                correct: 1,
                why: "Conocimiento empírico: en menguante la savia baja a las raíces, la madera tiene menos agua y no se apolilla."
            },
            {
                q: "El 'Fogón' o Tulpa (tres piedras) representa:",
                opts: [
                    "Pobreza.",
                    "El centro vital y espiritual de la familia, fuente de calor y cocción.",
                    "Suciedad.",
                    "Una bodega."
                ],
                correct: 1,
                why: "La arquitectura vernácula se organiza alrededor del fuego, no de la sala."
            },
            {
                q: "El uso del 'Color' (añil, tierra roja) en la fachada tenía una función técnica además de estética:",
                opts: [
                    "Ninguna.",
                    "El pigmento mineral ayuda a endurecer y proteger el enlucido de cal/tierra.",
                    "Espantar moscas.",
                    "Cumplir ordenanzas."
                ],
                correct: 1,
                why: "La cal con óxidos minerales crea una piel más resistente a la intemperie."
            },
            {
                q: "El 'Corredor' frontal es un espacio de:",
                opts: [
                    "Aislamiento.",
                    "Transición socio-espacial: permite interactuar con la calle/vecinos sin perder privacidad.",
                    "Almacenaje.",
                    "Cocina."
                ],
                correct: 1,
                why: "Es el umbral de la hospitalidad andina. Protege del sol y lluvia mientras se socializa."
            },
            {
                q: "¿Qué animal se solía usar para 'pisar' y mezclar el barro del adobe en grandes cantidades?",
                opts: [
                    "Perros.",
                    "Bueyes o Caballos.",
                    "Llamas.",
                    "Gallinas."
                ],
                correct: 1,
                why: "El peso y movimiento de los animales grandes garantizaba una mezcla homogénea de la arcilla y la paja."
            },
            {
                q: "La 'Chacra' o huerta trasera es fundamental porque:",
                opts: [
                    "Es un jardín decorativo.",
                    "Garantiza la subsistencia alimentaria y medicinal de la familia (autosuficiencia).",
                    "Es para jugar.",
                    "Es un basurero."
                ],
                correct: 1,
                why: "La vivienda vernácula es una unidad productiva, no solo residencial."
            }
        ]
    },
    {
        id: "MOD_03",
        title: "Guía Patrimonial: Religioso",
        desc: "Iglesias, Catedrales y Conventos",
        qs: [
            {
                q: "¿Quién diseñó la Catedral de la Inmaculada Concepción (Catedral Nueva) de Cuenca?",
                opts: [
                    "Francisco Grecco.",
                    "El Hermano Juan Bautista Stiehle (Redentorista alemán).",
                    "García Moreno.",
                    "Luis Felipe Donoso."
                ],
                correct: 1,
                why: "Stiehle es el arquitecto más influyente del s. XIX en el austro. Diseñó la Catedral, San Alfonso y Gualaceo."
            },
            {
                q: "La Catedral Vieja (Iglesia del Sagrario) data del año:",
                opts: [
                    "1800.",
                    "1557 (Fundacional), construida sobre piedras incas de Tomebamba.",
                    "1950.",
                    "1700."
                ],
                correct: 1,
                why: "Es el edificio más antiguo de la ciudad, testigo de la transición Inca-Colonial."
            },
            {
                q: "¿Qué estilo define a la Catedral Nueva?",
                opts: [
                    "Barroco.",
                    "Historicismo Ecléctico con predominio Neorrománico (planta basilical, arcos redondos).",
                    "Gótico puro.",
                    "Moderno."
                ],
                correct: 1,
                why: "Sus muros de ladrillo masivos y arcos de medio punto son románicos, aunque tiene detalles renacentistas."
            },
            {
                q: "El Monasterio de las Conceptas (1599) se caracteriza por:",
                opts: [
                    "Ser abierto.",
                    "Arquitectura de clausura total: muros ciegos altos, patios interiores y huerta inmensa.",
                    "Ser un edificio de oficinas.",
                    "Tener grandes ventanales a la calle."
                ],
                correct: 1,
                why: "Una ciudad dentro de la ciudad. Su hermetismo define una manzana entera del centro."
            },
            {
                q: "La Iglesia de San Blas era históricamente:",
                opts: [
                    "La Catedral.",
                    "Parroquia de Indios (ubicada en el límite de la traza española).",
                    "Un fuerte militar.",
                    "Un mercado."
                ],
                correct: 1,
                why: "Marcaba la segregación urbana colonial: Centro (blancos) vs. Periferia (indios)."
            },
            {
                q: "La Iglesia de Santo Domingo destaca por:",
                opts: [
                    "Ser de madera.",
                    "Su imponente fachada barroca y la Plaza que lleva su nombre.",
                    "Estar en el río.",
                    "Ser moderna."
                ],
                correct: 1,
                why: "Es uno de los hitos verticales más altos del perfil urbano colonial."
            },
            {
                q: "La Cruz del Vado marca:",
                opts: [
                    "El centro.",
                    "El balcón natural de la ciudad hacia el río y la entrada histórica desde la costa.",
                    "Un cementerio.",
                    "El mercado."
                ],
                correct: 1,
                why: "Hito simbólico de protección y límite urbano en el barrio artesanal del Vado."
            },
            {
                q: "El material 'Ladrillo Visto' en iglesias cuencanas se popularizó en:",
                opts: [
                    "La Colonia (s. XVII).",
                    "La República (finales s. XIX) gracias a Stiehle.",
                    "El Incario.",
                    "El año 2000."
                ],
                correct: 1,
                why: "Antes las iglesias eran de adobe encalado. El ladrillo visto es un sello de la modernización republicana."
            },
            {
                q: "¿Qué es una 'Espadaña' en una iglesia pequeña?",
                opts: [
                    "Una espada.",
                    "Muro vertical con vanos para las campanas (campanario plano), sin ser una torre.",
                    "Una puerta.",
                    "Una ventana."
                ],
                correct: 1,
                why: "Típico de capillas rurales o menores (ej. Carmen de la Asunción original)."
            },
            {
                q: "El Carmen de la Asunción es famoso por:",
                opts: [
                    "Ser moderno.",
                    "Su portada de piedra labrada barroca y el mercado de flores a sus pies.",
                    "Ser de ladrillo.",
                    "Estar en ruinas."
                ],
                correct: 1,
                why: "La portada de piedra es uno de los mejores ejemplos del barroco colonial en Cuenca."
            }
        ]
    },
    {
        id: "MOD_04",
        title: "Guía Patrimonial: Civil y S. XX",
        desc: "Edificios Públicos y Casas Notables",
        qs: [
            {
                q: "La 'Antigua Escuela Central' (Gran Colombia y Benigno Malo) es de estilo:",
                opts: [
                    "Colonial.",
                    "Republicano Neoclásico (Ladrillo visto, arcos, simetría).",
                    "Moderno.",
                    "Inca."
                ],
                correct: 1,
                why: "Obra maestra de la arquitectura educativa de Stiehle. Ladrillo, patio y arquerías."
            },
            {
                q: "El 'Puente Roto' (1849) sobre el Tomebamba colapsó por:",
                opts: [
                    "Terremoto.",
                    "La gran creciente del río del 3 de abril de 1950.",
                    "Mala calidad.",
                    "Guerra."
                ],
                correct: 1,
                why: "Era el puente principal. La riada se llevó el arco central, quedando como ruina histórica."
            },
            {
                q: "La 'Casa de los Arcos' es singular por:",
                opts: [
                    "Ser un castillo.",
                    "Estar construida sobre un arco que permite el paso de una acequia/canal.",
                    "Ser de oro.",
                    "No tener techo."
                ],
                correct: 1,
                why: "Solución ingeniosa para construir sobre la infraestructura hidráulica de la ciudad."
            },
            {
                q: "El 'Banco del Azuay' (1913) representa el auge económico y el estilo:",
                opts: [
                    "Vernáculo.",
                    "Neoclásico Francés (Academicismo), fachada de piedra/mármol.",
                    "Barroco.",
                    "High Tech."
                ],
                correct: 1,
                why: "El primer banco de la ciudad, símbolo de solidez y poder económico de la época."
            },
            {
                q: "La 'Casa de la Temperancia' (Museo de Arte Moderno) fue originalmente:",
                opts: [
                    "Una cárcel.",
                    "Casa de reclusión para alcohólicos y luego asilo.",
                    "Un hotel.",
                    "Un mercado."
                ],
                correct: 1,
                why: "Edificio de gran escala con múltiples patios, restaurado para uso cultural."
            },
            {
                q: "La 'Casa de las Posadas' (Calle Gran Colombia) es importante porque:",
                opts: [
                    "Es moderna.",
                    "Es uno de los últimos vestigios de vivienda colonial modesta/popular intacta.",
                    "Tiene ascensor.",
                    "Es de hormigón."
                ],
                correct: 1,
                why: "No es una mansión, es una posada de paso. Muestra la arquitectura del pueblo en la colonia."
            },
            {
                q: "El 'Hospital San Vicente de Paúl' (Museo de la Medicina) sigue el modelo:",
                opts: [
                    "Torre moderna.",
                    "Tipología francesa de pabellones aislados por jardines (higienismo).",
                    "Cueva.",
                    "Claustro cerrado."
                ],
                correct: 1,
                why: "La arquitectura médica del s. XIX buscaba ventilación cruzada para evitar 'miasmas'."
            },
            {
                q: "La 'Corte Superior de Justicia' (Sucre y Luis Cordero) es un ejemplo de:",
                opts: [
                    "Colonial.",
                    "Racionalismo Moderno (Años 70, Hormigón, Brisoleil).",
                    "Barroco.",
                    "Neoclásico."
                ],
                correct: 1,
                why: "La irrupción de la modernidad institucional en pleno centro histórico."
            },
            {
                q: "La 'Casa de las Palomas' (ICOMOS) tiene un estilo:",
                opts: [
                    "Racionalista.",
                    "Pintoresco / Romántico (Influencia de villa europea, murales exteriores).",
                    "Inca.",
                    "Minimalista."
                ],
                correct: 1,
                why: "Destaca por sus pinturas murales en la fachada y su aire de cuento de hadas."
            },
            {
                q: "El Arquitecto Francisco Grecco es autor de:",
                opts: [
                    "Catedral Vieja.",
                    "El antiguo Municipio (frente al parque) y casas eclécticas.",
                    "El puente roto.",
                    "Nada."
                ],
                correct: 1,
                why: "Italiano que trajo la decoración ecléctica y el gusto por las fachadas ornamentadas."
            }
        ]
    }
];

// SYSTEM CORE v8.0 (Robust Initialization)
const APP = {
    // State
    state: {
        activeMod: 0,
        idx: 0,
        score: 0,
        timer: 0,
        answers: {} // { mod_id: { q_idx: selected_opt } }
    },

    // DOM Elements Cache
    el: {},

    init() {
        // Cache DOM elements
        this.el.nav = document.getElementById('layer-list');
        this.el.main = document.getElementById('main-area');
        this.el.log = document.getElementById('prop-log');
        this.el.btn = document.getElementById('start-btn');
        this.el.uiMod = document.getElementById('ui-module');
        this.el.uiAcc = document.getElementById('ui-acc');
        this.el.uiTime = document.getElementById('ui-time');

        // Setup Event Listeners
        this.el.btn.addEventListener('click', () => this.loadModule(0));
        
        // Render Nav
        this.renderNav();
        
        // Start Global Timer
        setInterval(() => this.tick(), 1000);

        console.log("SYS: Ready.");
    },

    tick() {
        this.state.timer++;
        const m = Math.floor(this.state.timer / 60).toString().padStart(2,'0');
        const s = (this.state.timer % 60).toString().padStart(2,'0');
        this.el.uiTime.innerText = `${m}:${s}`;
    },

    renderNav() {
        this.el.nav.innerHTML = DB.map((mod, i) => `
            <div class="layer-btn ${i === this.state.activeMod ? 'active' : ''}" 
                 onclick="APP.loadModule(${i})">
                <span class="l-title">LAYER 0${i+1}</span>
                <span class="l-sub">${mod.title}</span>
            </div>
        `).join('');
    },

    loadModule(i) {
        this.state.activeMod = i;
        this.state.idx = 0;
        this.state.answers[i] = this.state.answers[i] || {}; // Init answer store for this mod
        
        this.el.uiMod.innerText = DB[i].id;
        this.renderNav(); // Update active class
        this.renderCard();
        this.log(`Loaded Module: ${DB[i].title}`);
    },

    renderCard() {
        const mod = DB[this.state.activeMod];
        const data = mod.qs[this.state.idx];
        const total = mod.qs.length;
        const prevAns = this.state.answers[this.state.activeMod][this.state.idx];

        this.el.main.innerHTML = `
            <div class="marker m-tl"></div><div class="marker m-tr"></div>
            <div class="marker m-bl"></div><div class="marker m-br"></div>
            
            <div class="q-meta">
                <span>SEQ: ${this.state.idx + 1} / ${total}</span>
                <span>${mod.desc}</span>
            </div>
            
            <div class="q-text">${data.q}</div>
            
            <div class="opts-grid">
                ${data.opts.map((opt, k) => `
                    <div class="opt" id="opt-${k}" onclick="APP.select(${k})">
                        <span class="opt-key">[${k+1}]</span> ${opt}
                    </div>
                `).join('')}
            </div>

            <div id="cmd-line" class="cmd-line"></div>

            <div class="toolbar">
                <button class="btn" onclick="APP.nav(-1)" ${this.state.idx === 0 ? 'disabled' : ''}>
                    < PREV
                </button>
                <button class="btn btn-primary" id="btn-act" onclick="APP.exec()" disabled>
                    EXECUTE >
                </button>
            </div>
        `;

        if (prevAns !== undefined) this.restoreState(prevAns, data);
    },

    select(k) {
        // Prevent changing if already answered
        if (this.state.answers[this.state.activeMod][this.state.idx] !== undefined) return;

        document.querySelectorAll('.opt').forEach(el => el.classList.remove('selected'));
        document.getElementById(`opt-${k}`).classList.add('selected');
        
        const btn = document.getElementById('btn-act');
        btn.disabled = false;
        btn.dataset.sel = k;
    },

    exec() {
        const sel = parseInt(document.getElementById('btn-act').dataset.sel);
        const mod = DB[this.state.activeMod];
        const data = mod.qs[this.state.idx];

        // Save Answer
        this.state.answers[this.state.activeMod][this.state.idx] = sel;

        // Scoring
        if (sel === data.correct) {
            this.state.score += 10;
            this.log(`CHECK: Correct. ${data.why.substring(0,20)}...`);
        } else {
            this.log(`CHECK: Error. Exp: ${data.opts[data.correct]}`);
        }
        
        this.updateStats();
        this.restoreState(sel, data);
    },

    restoreState(sel, data) {
        const cmd = document.getElementById('cmd-line');
        const btn = document.getElementById('btn-act');
        const mod = DB[this.state.activeMod];

        // Lock UI
        document.querySelectorAll('.opt').forEach(el => {
            el.classList.remove('selected');
            el.style.pointerEvents = 'none';
            el.style.opacity = '0.5';
        });

        // Show Result
        const isOk = sel === data.correct;
        const selEl = document.getElementById(`opt-${sel}`);
        const corEl = document.getElementById(`opt-${data.correct}`);

        if (selEl) {
            selEl.style.opacity = '1';
            selEl.classList.add(isOk ? 'correct' : 'wrong');
        }
        if (!isOk && corEl) {
            corEl.style.opacity = '1';
            corEl.classList.add('correct');
        }

        // Feedback
        cmd.style.display = 'block';
        cmd.className = `cmd-line ${isOk ? 'ok' : 'err'}`;
        cmd.innerHTML = `> STATUS: ${isOk ? 'VERIFIED' : 'FAILURE'}<span class="cmd-detail">${data.why}</span>`;

        // Next Button Logic
        const isLast = this.state.idx === mod.qs.length - 1;
        btn.innerText = isLast ? "MODULE COMPLETE" : "NEXT >";
        btn.disabled = false;
        btn.onclick = () => isLast ? this.finishModule() : this.nav(1);
    },

    nav(dir) {
        this.state.idx += dir;
        this.renderCard();
    },

    finishModule() {
        const nextMod = this.state.activeMod + 1;
        const hasNext = nextMod < DB.length;
        
        this.el.main.innerHTML = `
            <div class="splash">
                <h1 style="color:var(--cyan)">MÓDULO COMPLETADO</h1>
                <p>Datos integrados correctamente.</p>
                ${hasNext 
                    ? `<button class="btn btn-primary" onclick="APP.loadModule(${nextMod})">INICIAR SIGUIENTE CAPA</button>` 
                    : `<div style="border:1px solid var(--accent); padding:20px; color:var(--accent);">SISTEMA FINALIZADO. LISTO PARA EXAMEN.</div>`}
            </div>
        `;
    },

    log(msg) {
        // Avoid duplicate spam
        if (this.el.log.innerHTML.includes(msg.substring(0, 10))) return;
        
        const entry = document.createElement('div');
        entry.className = 'prop-item';
        entry.innerHTML = `<span class="prop-key">LOG_${this.state.timer}</span> ${msg}`;
        this.el.log.prepend(entry);
    },

    updateStats() {
        // Calculate rough % based on current progress
        // This is a simplified metric for the HUD
        this.el.uiAcc.innerText = this.state.score;
    }
};

// Start
document.addEventListener('DOMContentLoaded', () => APP.init());

</script>
</body>
</html>